<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¦'×§ ×œ×™×¡×˜×™× - ×¡×™× ××” ×¡×™×˜×™</title>
    <link rel="stylesheet" href="../../assets/css/main.css">
    <link rel="stylesheet" href="assets/css/checklists.css">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-title">
                <span style="font-size: 2rem;">âœ…</span>
                <div>
                    <h1>×¦'×§ ×œ×™×¡×˜×™× ×“×™×’×™×˜×œ×™×™×</h1>
                    <div style="font-size: 0.9rem; opacity: 0.9;">× ×™×”×•×œ ××©×™××•×ª ×•×‘×“×™×§×•×ª ×™×•××™×•×ª</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="goBack()">
                    â†’ ×—×–×¨×” ×œ×“××©×‘×•×¨×“
                </button>
                <button class="btn btn-secondary" onclick="showHistory()">
                    ğŸ“‹ ×”×™×¡×˜×•×¨×™×”
                </button>
                <button class="btn btn-secondary" onclick="exportReport()">
                    ğŸ“¤ ×™×™×¦× ×“×•×—
                </button>
                <button class="btn btn-primary" onclick="createNewChecklist()">
                    â• ×¦'×§ ×œ×™×¡×˜ ×—×“×©
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Quick Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value success">18</div>
                <div class="stat-label">×”×•×©×œ××• ×”×™×•×</div>
            </div>
            <div class="stat-card">
                <div class="stat-value warning">7</div>
                <div class="stat-label">×××ª×™× ×•×ª</div>
            </div>
            <div class="stat-card">
                <div class="stat-value error">2</div>
                <div class="stat-label">×‘××™×—×•×¨</div>
            </div>
            <div class="stat-card">
                <div class="stat-value primary">92%</div>
                <div class="stat-label">×”×©×œ××” ×©×‘×•×¢×™×ª</div>
            </div>
        </div>

        <!-- Checklist Types -->
        <div class="checklist-types">
            <!-- Event Checklist -->
            <div class="checklist-type event" onclick="openChecklist('event')">
                <div class="type-header">
                    <div class="type-title">
                        <div class="type-icon event">ğŸ¬</div>
                        <div>
                            <div>×‘×“×™×§×ª ××ª×—× ××—×¨×™ ××™×¨×•×¢×™×</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary); font-weight: normal;">
                                × ×™×§×™×•×Ÿ ×•×”×›× ×” ×œ××™×¨×•×¢ ×”×‘×
                            </div>
                        </div>
                    </div>
                    <div class="type-status">
                        <div class="status-indicator status-pending"></div>
                        <span>×‘×ª×”×œ×™×š</span>
                    </div>
                </div>
                <div class="type-description">
                    ×‘×“×™×§×ª ××ª×—× ×˜×¨×§×œ×™×Ÿ, ×‘×¨ VIP, ××˜×‘×— ×•××—×¡× ×™×. ×”×—×–×¨×ª ×¦×™×•×“ ×œ××§×•× ×•× ×™×§×™×•×Ÿ ×™×¡×•×“×™.
                </div>
                <div class="type-progress">
                    <div class="progress-bar event" style="width: 65%;"></div>
                </div>
                <div class="type-footer">
                    <div class="tasks-count">13/20 ××©×™××•×ª</div>
                    <div class="last-update">×¢×•×“×›×Ÿ ×œ×¤× ×™ 15 ×“×§×•×ª</div>
                </div>
            </div>

            <!-- Daily Checklist -->
            <div class="checklist-type daily" onclick="openChecklist('daily')">
                <div class="type-header">
                    <div class="type-title">
                        <div class="type-icon daily">ğŸ¢</div>
                        <div>
                            <div>×¡×’×™×¨×” ×™×•××™×ª ×‘××—×œ×§×•×ª</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary); font-weight: normal;">
                                ×§×•×¤×•×ª, VIP, ××–× ×•×Ÿ, ×¡×“×¨× ×™×
                            </div>
                        </div>
                    </div>
                    <div class="type-status">
                        <div class="status-indicator status-complete"></div>
                        <span>×”×•×©×œ×</span>
                    </div>
                </div>
                <div class="type-description">
                    ×‘×“×™×§×ª ×§×•×¤×•×ª, × ×¢×™×œ×ª ××–× ×•×Ÿ, ×”×—×–×¨×ª ×¦×™×•×“ ×¡×“×¨× ×™× ×•×‘×“×™×§×ª ×›×œ ×”××¢×¨×›×•×ª.
                </div>
                <div class="type-progress">
                    <div class="progress-bar daily" style="width: 100%;"></div>
                </div>
                <div class="type-footer">
                    <div class="tasks-count">25/25 ××©×™××•×ª</div>
                    <div class="last-update">×”×•×©×œ× ×œ×¤× ×™ ×©×¢×”</div>
                </div>
            </div>

            <!-- Cleaning Checklist -->
            <div class="checklist-type cleaning" onclick="openChecklist('cleaning')">
                <div class="type-header">
                    <div class="type-title">
                        <div class="type-icon cleaning">ğŸ§¹</div>
                        <div>
                            <div>× ×™×§×™×•×Ÿ ××ª×—× ×‘×•×§×¨</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary); font-weight: normal;">
                                ××•×œ××•×ª, ×©×™×¨×•×ª×™×, ×œ×•×‘×™
                            </div>
                        </div>
                    </div>
                    <div class="type-status">
                        <div class="status-indicator status-overdue"></div>
                        <span>×‘××™×—×•×¨</span>
                    </div>
                </div>
                <div class="type-description">
                    × ×™×§×™×•×Ÿ ×™×¡×•×“×™ ×©×œ ×›×œ ×”××•×œ××•×ª, ×©×™×¨×•×ª×™×, ××ª×—× ×”×œ×•×‘×™ ×•×‘×“×™×§×ª ×¦×™×•×“ ×”× ×™×§×™×•×Ÿ.
                </div>
                <div class="type-progress">
                    <div class="progress-bar cleaning" style="width: 40%;"></div>
                </div>
                <div class="type-footer">
                    <div class="tasks-count">6/15 ××©×™××•×ª</div>
                    <div class="last-update">××™×—×•×¨ ×©×œ 30 ×“×§×•×ª</div>
                </div>
            </div>
        </div>

        <!-- Active Tasks -->
        <div class="active-tasks">
            <div class="section-title">
                ğŸ”¥ ××©×™××•×ª ×“×—×•×¤×•×ª
            </div>
            <div class="task-list">
                <div class="task-item urgent">
                    <div class="task-header">
                        <div class="task-title">×‘×“×™×§×ª ××§×¨×¨ ××–× ×•×Ÿ B - ×˜××¤×¨×˜×•×¨×” ×’×‘×•×”×”</div>
                        <div class="task-priority priority-high">×“×—×•×£</div>
                    </div>
                    <div class="task-details">
                        ××§×¨×¨ ××¦×™×’ 8.5Â°C - ×—×¨×™×’×” ××”×˜×•×•×— ×”×ª×§×™×Ÿ. ×“×¨×•×©×” ×‘×“×™×§×” ××™×™×“×™×ª.
                    </div>
                    <div class="task-footer">
                        <div class="task-time">× ×¤×ª×— ×œ×¤× ×™ 10 ×“×§×•×ª</div>
                        <button class="task-action" onclick="handleTask('fridge')">×˜×¤×œ ×¢×›×©×™×•</button>
                    </div>
                </div>

                <div class="task-item overdue">
                    <div class="task-header">
                        <div class="task-title">× ×™×§×™×•×Ÿ ××•×œ××•×ª 3, 5, 7 - ×œ× ×”×•×©×œ×</div>
                        <div class="task-priority priority-high">×‘××™×—×•×¨</div>
                    </div>
                    <div class="task-details">
                        ×¦'×§ ×œ×™×¡×˜ × ×™×§×™×•×Ÿ ×‘×•×§×¨ ×œ× ×”×•×©×œ× - 3 ××•×œ××•×ª ×“×•×¨×©×™× ×˜×™×¤×•×œ.
                    </div>
                    <div class="task-footer">
                        <div class="task-time">××™×—×•×¨ ×©×œ 25 ×“×§×•×ª</div>
                        <button class="task-action" onclick="handleTask('cleaning')">×”×ª×—×œ × ×™×§×™×•×Ÿ</button>
                    </div>
                </div>

                <div class="task-item">
                    <div class="task-header">
                        <div class="task-title">×”×—×–×¨×ª ×¦×™×•×“ ×¡×“×¨× ×™× - ×¡×•×¨×§×™× ×•×§×©×¨×™×</div>
                        <div class="task-priority priority-medium">×¨×’×™×œ</div>
                    </div>
                    <div class="task-details">
                        ×”×—×–×¨×ª ×”×¦×™×•×“ ×œ××©×¨×“ ×× ×”"×© ×•×”×˜×¢× ×” ×œ×§×¨××ª ×”××©××¨×ª ×”×‘××”.
                    </div>
                    <div class="task-footer">
                        <div class="task-time">× ×•×ª×¨ 45 ×“×§×•×ª</div>
                        <button class="task-action" onclick="handleTask('equipment')">×”×ª×—×œ ××©×™××”</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
	<!-- ××•×“××œ ×™×¦×™×¨×ª ×¦'×§ ×œ×™×¡×˜ -->
	<div id="createChecklistModal" class="modal">
		<div class="modal-content">
			<div class="modal-header">
				<h2>×‘×—×¨ ×ª×‘× ×™×ª ×¦'×§ ×œ×™×¡×˜</h2>
				<button class="close-btn" onclick="closeModal()">âœ•</button>
			</div>
			<div class="modal-body">
				<div class="templates-grid" id="templatesGrid">
					<!-- ×”×ª×‘× ×™×•×ª ×™×˜×¢× ×• ×›××Ÿ -->
				</div>
			</div>
			<div class="modal-footer">
				<button class="btn btn-secondary" onclick="closeModal()">×‘×™×˜×•×œ</button>
				<button id="adminCreateTemplateBtn" class="btn btn-primary" onclick="openTemplateCreator()" style="display: none;">
					â• ×¦×•×¨ ×ª×‘× ×™×ª ×—×“×©×”
				</button>
			</div>
		</div>
	</div>

	<!-- ××•×“××œ ×™×¦×™×¨×ª ×ª×‘× ×™×ª (×œ×× ×”×œ×™×) -->
	<div id="createTemplateModal" class="modal">
		<div class="modal-content">
			<div class="modal-header">
				<h2>×™×¦×™×¨×ª ×ª×‘× ×™×ª ×—×“×©×”</h2>
				<button class="close-btn" onclick="closeTemplateModal()">âœ•</button>
			</div>
			<div class="modal-body">
				<div class="form-group">
					<label>×©× ×”×ª×‘× ×™×ª</label>
					<input type="text" id="templateName" placeholder="×œ×“×•×’××”: ×‘×“×™×§×ª ×¦×™×•×“ ×”×§×¨× ×”">
				</div>
				<div class="form-group">
					<label>×ª×™××•×¨</label>
					<textarea id="templateDescription" placeholder="×ª×™××•×¨ ×§×¦×¨ ×©×œ ×”×ª×‘× ×™×ª"></textarea>
				</div>
				<div class="form-group">
					<label>×¡×•×’</label>
					<select id="templateType">
						<option value="daily">×™×•××™</option>
						<option value="event">××™×¨×•×¢</option>
						<option value="cleaning">× ×™×§×™×•×Ÿ</option>
						<option value="safety">×‘×˜×™×—×•×ª</option>
						<option value="maintenance">×ª×—×–×•×§×”</option>
						<option value="custom">××—×¨</option>
					</select>
				</div>
				<div class="form-group">
					<label>××©×™××•×ª</label>
					<div id="tasksList">
						<div class="task-input-group">
							<input type="text" placeholder="××©×™××” 1" class="task-input">
							<label><input type="checkbox" checked> ×—×•×‘×”</label>
						</div>
					</div>
					<button class="btn btn-secondary" onclick="addTaskInput()">+ ×”×•×¡×£ ××©×™××”</button>
				</div>
			</div>
			<div class="modal-footer">
				<button class="btn btn-secondary" onclick="closeTemplateModal()">×‘×™×˜×•×œ</button>
				<button class="btn btn-primary" onclick="saveTemplate()">×©××•×¨ ×ª×‘× ×™×ª</button>
			</div>
		</div>
	</div>

	<script>
	// ××¢×¨×›×ª ×ª×‘× ×™×•×ª ×¦'×§ ×œ×™×¡×˜×™×
	const ChecklistTemplates = {
		// ×˜×¢×™× ×ª ×ª×‘× ×™×•×ª ×-localStorage
		getTemplates: function() {
			const saved = localStorage.getItem('cinema_checklist_templates');
			if (saved) {
				return JSON.parse(saved);
			}
			
			// ×ª×‘× ×™×•×ª ×‘×¨×™×¨×ª ××—×“×œ
			const defaultTemplates = [
				{
					id: 't1',
					name: '×‘×“×™×§×ª ××ª×—× ××—×¨×™ ××™×¨×•×¢×™×',
					type: 'event',
					description: '×‘×“×™×§×ª ××ª×—× ×˜×¨×§×œ×™×Ÿ, ×‘×¨ VIP, ××˜×‘×— ×•××—×¡× ×™×',
					tasks: [
						{ id: 1, title: '×‘×“×™×§×ª × ×™×§×™×•×Ÿ ×˜×¨×§×œ×™×Ÿ VIP', required: true },
						{ id: 2, title: '×”×—×–×¨×ª ×¦×™×•×“ ×‘×¨ ×œ××§×•×', required: true },
						{ id: 3, title: '×‘×“×™×§×ª ××œ××™ ××©×§××•×ª', required: false },
						{ id: 4, title: '× ×™×§×•×™ ××˜×‘×—', required: true },
						{ id: 5, title: '×¡×’×™×¨×ª ××¢×¨×›×•×ª ×ª××•×¨×”', required: true },
						{ id: 6, title: '× ×¢×™×œ×ª ××—×¡× ×™×', required: true },
						{ id: 7, title: '×‘×“×™×§×ª ×©×™×¨×•×ª×™ VIP', required: true },
						{ id: 8, title: '××™×¡×•×£ ××‘×™×“×•×ª', required: false },
						{ id: 9, title: '×ª×™×¢×•×“ × ×–×§×™× ×× ×™×©× ×', required: false },
						{ id: 10, title: '×“×™×•×•×— ×œ×× ×”×œ ××©××¨×ª', required: true }
					],
					createdBy: '××¢×¨×›×ª',
					isSystem: true
				},
				{
					id: 't2',
					name: '×¡×’×™×¨×” ×™×•××™×ª ×‘××—×œ×§×•×ª',
					type: 'daily',
					description: '×‘×“×™×§×ª ×§×•×¤×•×ª, × ×¢×™×œ×ª ××–× ×•×Ÿ, ×”×—×–×¨×ª ×¦×™×•×“',
					tasks: [
						{ id: 1, title: '×¡×¤×™×¨×ª ×§×•×¤×” ×¨××©×™×ª', required: true },
						{ id: 2, title: '×¡×¤×™×¨×ª ×§×•×¤×•×ª ××©× ×”', required: true },
						{ id: 3, title: '×”×¤×§×“×ª ×›×¡×¤×™× ×‘×›×¡×¤×ª', required: true },
						{ id: 4, title: '× ×¢×™×œ×ª ××–× ×•×Ÿ', required: true },
						{ id: 5, title: '×›×™×‘×•×™ ××›×•× ×•×ª ×¤×•×¤×§×•×¨×Ÿ', required: true },
						{ id: 6, title: '× ×™×§×•×™ ×“×œ×¤×§×™×', required: true },
						{ id: 7, title: '×”×—×–×¨×ª ×¦×™×•×“ ×¡×“×¨× ×™×', required: true },
						{ id: 8, title: '×‘×“×™×§×ª ××•×œ××•×ª', required: true },
						{ id: 9, title: '×›×™×‘×•×™ ××¢×¨×›×•×ª', required: true },
						{ id: 10, title: '× ×¢×™×œ×ª ××©×¨×“×™×', required: true },
						{ id: 11, title: '×”×¤×¢×œ×ª ××–×¢×§×”', required: true },
						{ id: 12, title: '×“×™×•×•×— ×¡×™×•× ××©××¨×ª', required: true }
					],
					createdBy: '××¢×¨×›×ª',
					isSystem: true
				},
				{
					id: 't3',
					name: '× ×™×§×™×•×Ÿ ××ª×—× ×‘×•×§×¨',
					type: 'cleaning',
					description: '× ×™×§×™×•×Ÿ ×™×¡×•×“×™ ×©×œ ×›×œ ×”××•×œ××•×ª, ×©×™×¨×•×ª×™×, ×œ×•×‘×™',
					tasks: [
						{ id: 1, title: '× ×™×§×™×•×Ÿ ××•×œ× 1', required: true },
						{ id: 2, title: '× ×™×§×™×•×Ÿ ××•×œ× 2', required: true },
						{ id: 3, title: '× ×™×§×™×•×Ÿ ××•×œ× 3', required: true },
						{ id: 4, title: '× ×™×§×™×•×Ÿ ×©×™×¨×•×ª×™× ×§×•××” ×', required: true },
						{ id: 5, title: '× ×™×§×™×•×Ÿ ×©×™×¨×•×ª×™× ×§×•××” ×‘', required: true },
						{ id: 6, title: '× ×™×§×™×•×Ÿ ×œ×•×‘×™ ×¨××©×™', required: true },
						{ id: 7, title: '×¨×™×§×•×Ÿ ×¤×—×™ ××©×¤×”', required: true },
						{ id: 8, title: '××™×œ×•×™ ×—×•××¨×™ × ×™×§×™×•×Ÿ', required: true }
					],
					createdBy: '××¢×¨×›×ª',
					isSystem: true
				},
				{
					id: 't4',
					name: '×‘×“×™×§×ª ×‘×˜×™×—×•×ª ×™×•××™×ª',
					type: 'safety',
					description: '×‘×“×™×§×ª ×ª×§×™× ×•×ª ×¦×™×•×“ ×‘×˜×™×—×•×ª ×•××¢×¨×›×•×ª ×—×™×¨×•×',
					tasks: [
						{ id: 1, title: '×‘×“×™×§×ª ×™×¦×™××•×ª ×—×™×¨×•×', required: true },
						{ id: 2, title: '×‘×“×™×§×ª ×ª××•×¨×ª ×—×™×¨×•×', required: true },
						{ id: 3, title: '×‘×“×™×§×ª ××˜×¤×™×', required: true },
						{ id: 4, title: '×‘×“×™×§×ª ×’×œ××™ ×¢×©×Ÿ', required: true },
						{ id: 5, title: '×‘×“×™×§×ª ××¢×¨×›×ª ×›×¨×™×–×”', required: true },
						{ id: 6, title: '×‘×“×™×§×ª ×¢×¨×›×•×ª ×¢×–×¨×” ×¨××©×•× ×”', required: true }
					],
					createdBy: '××¢×¨×›×ª',
					isSystem: true
				}
			];
			
			this.saveTemplates(defaultTemplates);
			return defaultTemplates;
		},
		
		// ×©××™×¨×ª ×ª×‘× ×™×•×ª
		saveTemplates: function(templates) {
			localStorage.setItem('cinema_checklist_templates', JSON.stringify(templates));
		},
		
		// ×”×•×¡×¤×ª ×ª×‘× ×™×ª ×—×“×©×”
		addTemplate: function(templateData) {
			const templates = this.getTemplates();
			const newId = 't' + (templates.length + 1);
			
			const newTemplate = {
				...templateData,
				id: newId,
				createdAt: new Date().toISOString(),
				createdBy: localStorage.getItem('username') || '××©×ª××©',
				isSystem: false
			};
			
			templates.push(newTemplate);
			this.saveTemplates(templates);
			return newTemplate;
		},
		
		// ××—×™×§×ª ×ª×‘× ×™×ª (×¨×§ ×ª×‘× ×™×•×ª ××•×ª×××•×ª ××™×©×™×ª)
		deleteTemplate: function(id) {
			const templates = this.getTemplates();
			const filtered = templates.filter(t => t.id !== id || t.isSystem);
			this.saveTemplates(filtered);
		}
	};

	// ××¢×¨×›×ª × ×™×”×•×œ ×¦'×§ ×œ×™×¡×˜×™×
	const ChecklistsDB = {
		// ×˜×¢×™× ×ª ×¦'×§ ×œ×™×¡×˜×™× ×-localStorage
		getChecklists: function() {
			const saved = localStorage.getItem('cinema_checklists');
			if (saved) {
				return JSON.parse(saved);
			}
			
			const defaultChecklists = [];
			this.saveChecklists(defaultChecklists);
			return defaultChecklists;
		},
		
		// ×©××™×¨×ª ×¦'×§ ×œ×™×¡×˜×™×
		saveChecklists: function(checklists) {
			localStorage.setItem('cinema_checklists', JSON.stringify(checklists));
		},
		
		// ×™×¦×™×¨×ª ×¦'×§ ×œ×™×¡×˜ ××ª×‘× ×™×ª
		createFromTemplate: function(templateId) {
			const templates = ChecklistTemplates.getTemplates();
			const template = templates.find(t => t.id === templateId);
			
			if (!template) {
				return null;
			}
			
			const checklists = this.getChecklists();
			const newId = Math.max(...checklists.map(c => c.id), 0) + 1;
			
			// ×™×¦×™×¨×ª ×©× ××•×˜×•××˜×™ ×¢× ×ª××¨×™×š
			const today = new Date().toLocaleDateString('he-IL');
			const title = `${template.name} - ${today}`;
			
			// ×”×¢×ª×§×ª ×”××©×™××•×ª ××”×ª×‘× ×™×ª
			const tasks = template.tasks.map(task => ({
				...task,
				completed: false
			}));
			
			const newChecklist = {
				id: newId,
				templateId: templateId,
				type: template.type,
				title: title,
				description: template.description,
				status: 'pending',
				totalTasks: tasks.length,
				completedTasks: 0,
				tasks: tasks,
				createdAt: new Date().toISOString(),
				lastUpdate: new Date().toISOString(),
				createdBy: localStorage.getItem('username') || '××©×ª××©',
				assignedTo: localStorage.getItem('username') || '××©×ª××©',
				dueTime: null
			};
			
			checklists.push(newChecklist);
			this.saveChecklists(checklists);
			return newChecklist;
		},
		
		// ×¢×“×›×•×Ÿ ×¦'×§ ×œ×™×¡×˜
		updateChecklist: function(id, data) {
			const checklists = this.getChecklists();
			const index = checklists.findIndex(c => c.id === id);
			
			if (index !== -1) {
				checklists[index] = {
					...checklists[index],
					...data,
					lastUpdate: new Date().toISOString()
				};
				
				// ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ××•×˜×•××˜×™
				if (checklists[index].completedTasks === checklists[index].totalTasks) {
					checklists[index].status = 'completed';
				} else if (checklists[index].dueTime && new Date() > new Date(checklists[index].dueTime)) {
					checklists[index].status = 'overdue';
				} else if (checklists[index].completedTasks > 0) {
					checklists[index].status = 'in_progress';
				}
				
				this.saveChecklists(checklists);
				return checklists[index];
			}
			return null;
		},
		
		// ××—×™×§×ª ×¦'×§ ×œ×™×¡×˜
		deleteChecklist: function(id) {
			const checklists = this.getChecklists();
			const filtered = checklists.filter(c => c.id !== id);
			this.saveChecklists(filtered);
		},
		
		// ×§×‘×œ×ª ×¡×˜×˜×™×¡×˜×™×§×•×ª
		getStats: function() {
			const checklists = this.getChecklists();
			const today = new Date().toDateString();
			
			const todayChecklists = checklists.filter(c => 
				new Date(c.lastUpdate).toDateString() === today
			);
			
			return {
				completed: todayChecklists.filter(c => c.status === 'completed').length,
				pending: checklists.filter(c => c.status === 'pending' || c.status === 'in_progress').length,
				overdue: checklists.filter(c => c.status === 'overdue').length,
				weeklyCompletion: this.calculateWeeklyCompletion()
			};
		},
		
		// ×—×™×©×•×‘ ××—×•×– ×”×©×œ××” ×©×‘×•×¢×™
		calculateWeeklyCompletion: function() {
			const checklists = this.getChecklists();
			const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
			
			const weeklyChecklists = checklists.filter(c => 
				new Date(c.lastUpdate) >= weekAgo
			);
			
			if (weeklyChecklists.length === 0) return 100;
			
			const completed = weeklyChecklists.filter(c => c.status === 'completed').length;
			return Math.round((completed / weeklyChecklists.length) * 100);
		}
	};

	// ××©×™××•×ª ×“×—×•×¤×•×ª
	const UrgentTasks = {
		getTasks: function() {
			const saved = localStorage.getItem('cinema_urgent_tasks');
			if (saved) {
				return JSON.parse(saved);
			}
			
			const defaultTasks = [];
			this.saveTasks(defaultTasks);
			return defaultTasks;
		},
		
		saveTasks: function(tasks) {
			localStorage.setItem('cinema_urgent_tasks', JSON.stringify(tasks));
		},
		
		completeTask: function(id) {
			const tasks = this.getTasks();
			const index = tasks.findIndex(t => t.id === id);
			if (index !== -1) {
				tasks[index].status = 'completed';
				tasks[index].completedAt = new Date().toISOString();
				this.saveTasks(tasks);
			}
		}
	};

	// ××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
	let currentFilter = 'active';
	let selectedTemplateId = null;

	// ×¤×•× ×§×¦×™×•×ª ×¢×–×¨
	function hasPermission(permission) {
		if (typeof PermissionsManager !== 'undefined') {
			return PermissionsManager.hasPermission(permission);
		}
		
		const userRole = localStorage.getItem('userRole') || sessionStorage.getItem('userRole');
		
		if (userRole === 'admin' || userRole === 'manager') {
			return true;
		}
		
		const rolePermissions = {
			'supervisor': ['checklist_view', 'checklist_fill', 'checklist_approve', 'checklist_create'],
			'worker': ['checklist_view', 'checklist_fill'],
			'usher': ['checklist_view', 'checklist_fill']
		};
		
		return rolePermissions[userRole]?.includes(permission) || false;
	}

	function getTimeAgo(dateString) {
		const date = new Date(dateString);
		const now = new Date();
		const diff = Math.floor((now - date) / 1000);
		
		if (diff < 60) return '×¢×›×©×™×•';
		if (diff < 3600) return `×œ×¤× ×™ ${Math.floor(diff / 60)} ×“×§×•×ª`;
		if (diff < 86400) return `×œ×¤× ×™ ${Math.floor(diff / 3600)} ×©×¢×•×ª`;
		return `×œ×¤× ×™ ${Math.floor(diff / 86400)} ×™××™×`;
	}

	function getMinutesAgo(dateString) {
		const date = new Date(dateString);
		const now = new Date();
		return Math.floor((now - date) / 60000);
	}

	// ×™×¦×™×¨×ª ×¦'×§ ×œ×™×¡×˜ ×—×“×© - ×¤×ª×™×—×ª ××•×“××œ
	function createNewChecklist() {
		if (!hasPermission('checklist_create')) {
			showMessage('××™×Ÿ ×œ×š ×”×¨×©××” ×œ×™×¦×•×¨ ×¦\'×§ ×œ×™×¡×˜×™× ×—×“×©×™×', 'error');
			return;
		}
		
		loadTemplatesModal();
		document.getElementById('createChecklistModal').classList.add('active');
	}

	// ×˜×¢×™× ×ª ×ª×‘× ×™×•×ª ×œ××•×“××œ
	function loadTemplatesModal() {
		const templates = ChecklistTemplates.getTemplates();
		const grid = document.getElementById('templatesGrid');
		const userRole = localStorage.getItem('userRole') || sessionStorage.getItem('userRole');
		
		grid.innerHTML = '';
		
		const typeIcons = {
			'event': 'ğŸ¬',
			'daily': 'ğŸ¢',
			'cleaning': 'ğŸ§¹',
			'safety': 'ğŸ”’',
			'maintenance': 'ğŸ”§',
			'custom': 'ğŸ“‹'
		};
		
		templates.forEach(template => {
			const card = document.createElement('div');
			card.className = 'template-card';
			card.onclick = () => selectTemplate(template.id);
			
			card.innerHTML = `
				<span class="template-badge ${template.isSystem ? 'system' : 'custom'}">
					${template.isSystem ? '××¢×¨×›×ª' : '××•×ª×× ××™×©×™×ª'}
				</span>
				<span class="template-icon">${typeIcons[template.type] || 'ğŸ“‹'}</span>
				<div class="template-name">${template.name}</div>
				<div class="template-description">${template.description}</div>
				<div class="template-info">
					<span class="template-tasks-count">${template.tasks.length} ××©×™××•×ª</span>
					<span>${template.createdBy}</span>
				</div>
			`;
			
			grid.appendChild(card);
		});
		
		// ×”×¦×’ ×›×¤×ª×•×¨ ×™×¦×™×¨×ª ×ª×‘× ×™×ª ×œ×× ×”×œ×™×
		if (userRole === 'admin') {
			document.getElementById('adminCreateTemplateBtn').style.display = 'inline-block';
		}
	}

	// ×‘×—×™×¨×ª ×ª×‘× ×™×ª
	function selectTemplate(templateId) {
		// ×”×¡×¨ ×‘×—×™×¨×” ×§×•×“××ª
		document.querySelectorAll('.template-card').forEach(card => {
			card.classList.remove('selected');
		});
		
		// ×¡××Ÿ ××ª ×”×›×¨×˜×™×¡ ×”× ×‘×—×¨
		event.currentTarget.classList.add('selected');
		selectedTemplateId = templateId;
		
		// ×™×¦×™×¨×ª ×”×¦'×§ ×œ×™×¡×˜ ××•×˜×•××˜×™×ª
		setTimeout(() => {
			createChecklistFromTemplate();
		}, 300);
	}

	// ×™×¦×™×¨×ª ×¦'×§ ×œ×™×¡×˜ ××”×ª×‘× ×™×ª ×”× ×‘×—×¨×ª
	function createChecklistFromTemplate() {
		if (!selectedTemplateId) {
			showMessage('×× × ×‘×—×¨ ×ª×‘× ×™×ª', 'error');
			return;
		}
		
		const newChecklist = ChecklistsDB.createFromTemplate(selectedTemplateId);
		
		if (newChecklist) {
			closeModal();
			showMessage(`×¦'×§ ×œ×™×¡×˜ "${newChecklist.title}" × ×•×¦×¨ ×‘×”×¦×œ×—×”!`, 'success');
			loadDashboard();
			
			// ×¤×ª×— ××ª ×”×¦'×§ ×œ×™×¡×˜ ×”×—×“×©
			setTimeout(() => {
				continueChecklist(newChecklist.id);
			}, 1000);
		}
	}

	// ×¡×’×™×¨×ª ××•×“××œ
	function closeModal() {
		document.getElementById('createChecklistModal').classList.remove('active');
		selectedTemplateId = null;
	}

	// ×¤×ª×™×—×ª ×™×•×¦×¨ ×ª×‘× ×™×•×ª (×œ×× ×”×œ×™×)
	function openTemplateCreator() {
		closeModal();
		document.getElementById('createTemplateModal').classList.add('active');
		
		// ××ª×—×•×œ ×¢× ××©×™××” ××—×ª
		document.getElementById('tasksList').innerHTML = `
			<div class="task-input-group">
				<input type="text" placeholder="××©×™××” 1" class="task-input">
				<label><input type="checkbox" checked> ×—×•×‘×”</label>
			</div>
		`;
	}

	// ×¡×’×™×¨×ª ××•×“××œ ×ª×‘× ×™×ª
	function closeTemplateModal() {
		document.getElementById('createTemplateModal').classList.remove('active');
	}

	// ×”×•×¡×¤×ª ×©×“×” ××©×™××”
	function addTaskInput() {
		const tasksList = document.getElementById('tasksList');
		const taskCount = tasksList.querySelectorAll('.task-input-group').length + 1;
		
		const taskGroup = document.createElement('div');
		taskGroup.className = 'task-input-group';
		taskGroup.innerHTML = `
			<input type="text" placeholder="××©×™××” ${taskCount}" class="task-input">
			<label><input type="checkbox" checked> ×—×•×‘×”</label>
			<button onclick="removeTaskInput(this)">×”×¡×¨</button>
		`;
		
		tasksList.appendChild(taskGroup);
	}

	// ×”×¡×¨×ª ×©×“×” ××©×™××”
	function removeTaskInput(button) {
		button.parentElement.remove();
	}

	// ×©××™×¨×ª ×ª×‘× ×™×ª ×—×“×©×”
	function saveTemplate() {
		const name = document.getElementById('templateName').value.trim();
		const description = document.getElementById('templateDescription').value.trim();
		const type = document.getElementById('templateType').value;
		
		if (!name) {
			showMessage('× × ×œ×”×–×™×Ÿ ×©× ×ª×‘× ×™×ª', 'error');
			return;
		}
		
		// ××™×¡×•×£ ××©×™××•×ª
		const tasks = [];
		document.querySelectorAll('.task-input-group').forEach((group, index) => {
			const input = group.querySelector('.task-input');
			const checkbox = group.querySelector('input[type="checkbox"]');
			
			if (input.value.trim()) {
				tasks.push({
					id: index + 1,
					title: input.value.trim(),
					required: checkbox.checked
				});
			}
		});
		
		if (tasks.length === 0) {
			showMessage('× × ×œ×”×•×¡×™×£ ×œ×¤×—×•×ª ××©×™××” ××—×ª', 'error');
			return;
		}
		
		// ×©××™×¨×ª ×”×ª×‘× ×™×ª
		const newTemplate = ChecklistTemplates.addTemplate({
			name: name,
			type: type,
			description: description,
			tasks: tasks
		});
		
		closeTemplateModal();
		showMessage(`×ª×‘× ×™×ª "${name}" × ×•×¦×¨×” ×‘×”×¦×œ×—×”!`, 'success');
		
		// ×©××œ ×× ×œ×™×¦×•×¨ ×¦'×§ ×œ×™×¡×˜ ××”×ª×‘× ×™×ª
		setTimeout(() => {
			if (confirm('×”×× ×œ×™×¦×•×¨ ×¦\'×§ ×œ×™×¡×˜ ××”×ª×‘× ×™×ª ×”×—×“×©×”?')) {
				const checklist = ChecklistsDB.createFromTemplate(newTemplate.id);
				if (checklist) {
					showMessage(`×¦'×§ ×œ×™×¡×˜ "${checklist.title}" × ×•×¦×¨ ×‘×”×¦×œ×—×”!`, 'success');
					loadDashboard();
				}
			}
		}, 500);
	}

	// ×”×¦×’×ª ×”×•×“×¢×”
	function showMessage(text, type = 'success') {
		const messageDiv = document.createElement('div');
		messageDiv.className = 'success-message';
		messageDiv.style.background = type === 'error' ? '#dc3545' : '#28a745';
		messageDiv.textContent = text;
		
		document.body.appendChild(messageDiv);
		
		setTimeout(() => {
			messageDiv.remove();
		}, 3000);
	}

	// ×”××©×š ×¦'×§ ×œ×™×¡×˜ ×§×™×™×
	function continueChecklist(id) {
		if (!hasPermission('checklist_fill')) {
			showMessage('××™×Ÿ ×œ×š ×”×¨×©××” ×œ××œ× ×¦\'×§ ×œ×™×¡×˜×™×', 'error');
			return;
		}
		
		const checklist = ChecklistsDB.getChecklists().find(c => c.id === id);
		if (!checklist) {
			showMessage('×¦\'×§ ×œ×™×¡×˜ ×œ× × ××¦×', 'error');
			return;
		}
		
		sessionStorage.setItem('currentChecklistId', id);
		
		// × ×ª×‘ ×œ×“×£ ×”××ª××™×
		if (checklist.type === 'event' || checklist.type === 'daily' || checklist.type === 'cleaning') {
			const paths = {
				'event': 'event-check.html',
				'daily': 'daily-closing.html',
				'cleaning': 'cleaning.html'
			};
			window.location.href = paths[checklist.type];
		} else {
			window.location.href = 'custom-checklist.html';
		}
	}

	// ×¢×¨×™×›×ª ×¦'×§ ×œ×™×¡×˜
	function editChecklist(id) {
		if (!hasPermission('checklist_create')) {
			showMessage('××™×Ÿ ×œ×š ×”×¨×©××” ×œ×¢×¨×•×š ×¦\'×§ ×œ×™×¡×˜×™×', 'error');
			return;
		}
		
		const checklist = ChecklistsDB.getChecklists().find(c => c.id === id);
		if (!checklist) return;
		
		const newTitle = prompt('×¢×¨×•×š ×›×•×ª×¨×ª:', checklist.title);
		if (newTitle && newTitle !== checklist.title) {
			ChecklistsDB.updateChecklist(id, { title: newTitle });
			loadDashboard();
		}
	}

	// ××—×™×§×ª ×¦'×§ ×œ×™×¡×˜ ×¢× ××™×©×•×¨
	function deleteChecklistConfirm(id) {
		if (!hasPermission('checklist_create')) {
			showMessage('××™×Ÿ ×œ×š ×”×¨×©××” ×œ××—×•×§ ×¦\'×§ ×œ×™×¡×˜×™×', 'error');
			return;
		}
		
		const checklist = ChecklistsDB.getChecklists().find(c => c.id === id);
		if (!checklist) return;
		
		if (confirm(`×”×× ×œ××—×•×§ ××ª ×”×¦\'×§ ×œ×™×¡×˜ "${checklist.title}"?`)) {
			ChecklistsDB.deleteChecklist(id);
			loadDashboard();
		}
	}

	// ×˜×¢×™× ×ª ×”×“××©×‘×•×¨×“
	function loadDashboard() {
		// ×˜×¢×™× ×ª ×¡×˜×˜×™×¡×˜×™×§×•×ª
		const stats = ChecklistsDB.getStats();
		document.querySelectorAll('.stat-value')[0].textContent = stats.completed;
		document.querySelectorAll('.stat-value')[1].textContent = stats.pending;
		document.querySelectorAll('.stat-value')[2].textContent = stats.overdue;
		document.querySelectorAll('.stat-value')[3].textContent = stats.weeklyCompletion + '%';
		
		// ×˜×¢×™× ×ª ×¦'×§ ×œ×™×¡×˜×™×
		loadChecklists();
		
		// ×˜×¢×™× ×ª ××©×™××•×ª ×“×—×•×¤×•×ª
		loadUrgentTasks();
	}

	// ×˜×¢×™× ×ª ×¦'×§ ×œ×™×¡×˜×™×
	function loadChecklists() {
		const checklists = ChecklistsDB.getChecklists();
		const container = document.querySelector('.checklist-types');
		
		// ×¡×™× ×•×Ÿ ×œ×¤×™ ×”××¦×‘ ×”× ×•×›×—×™
		let filteredChecklists = checklists;
		if (currentFilter === 'active') {
			filteredChecklists = checklists.filter(c => 
				c.status === 'pending' || c.status === 'in_progress' || c.status === 'overdue'
			);
		} else if (currentFilter === 'completed') {
			filteredChecklists = checklists.filter(c => c.status === 'completed');
		}
		
		// ×× ××™×Ÿ ×¦'×§ ×œ×™×¡×˜×™× ×œ×”×¦×’×”
		if (filteredChecklists.length === 0) {
			container.innerHTML = `
				<div style="text-align: center; padding: 40px; color: #666;">
					<div style="font-size: 48px; margin-bottom: 20px;">ğŸ“‹</div>
					<div style="font-size: 18px;">××™×Ÿ ×¦'×§ ×œ×™×¡×˜×™× ${currentFilter === 'completed' ? '×©×”×•×©×œ××•' : '×¤×¢×™×œ×™×'}</div>
					${hasPermission('checklist_create') ? 
						`<button class="btn btn-primary" onclick="createNewChecklist()" style="margin-top: 20px;">
							×¦×•×¨ ×¦'×§ ×œ×™×¡×˜ ×—×“×©
						</button>` : ''
					}
				</div>
			`;
			return;
		}
		
		container.innerHTML = '';
		
		filteredChecklists.forEach(checklist => {
			const progress = checklist.totalTasks > 0 ? 
				Math.round((checklist.completedTasks / checklist.totalTasks) * 100) : 0;
			
			const statusClass = checklist.status === 'completed' ? 'status-complete' : 
							   checklist.status === 'overdue' ? 'status-overdue' : 
							   checklist.status === 'in_progress' ? 'status-pending' : 'status-pending';
			
			const statusText = checklist.status === 'completed' ? '×”×•×©×œ×' :
							  checklist.status === 'overdue' ? '×‘××™×—×•×¨' :
							  checklist.status === 'in_progress' ? '×‘×ª×”×œ×™×š' : '×××ª×™×Ÿ';
			
			const lastUpdate = getTimeAgo(checklist.lastUpdate);
			
			const typeIcons = {
				'event': 'ğŸ¬',
				'daily': 'ğŸ¢',
				'cleaning': 'ğŸ§¹',
				'safety': 'ğŸ”’',
				'maintenance': 'ğŸ”§',
				'custom': 'ğŸ“‹'
			};
			
			const html = `
				<div class="checklist-type ${checklist.type}" data-id="${checklist.id}">
					<div class="type-header" onclick="continueChecklist(${checklist.id})">
						<div class="type-title">
							<div class="type-icon ${checklist.type}">${typeIcons[checklist.type] || 'ğŸ“‹'}</div>
							<div>
								<div>${checklist.title}</div>
								<div style="font-size: 0.8rem; color: var(--text-secondary); font-weight: normal;">
									${checklist.assignedTo} | ID: ${checklist.id}
								</div>
							</div>
						</div>
						<div class="type-status">
							<div class="status-indicator ${statusClass}"></div>
							<span>${statusText}</span>
						</div>
					</div>
					<div class="type-description">${checklist.description}</div>
					<div class="type-progress">
						<div class="progress-bar ${checklist.type}" style="width: ${progress}%;"></div>
					</div>
					<div class="type-footer">
						<div class="tasks-count">${checklist.completedTasks}/${checklist.totalTasks} ××©×™××•×ª</div>
						<div class="last-update">${lastUpdate}</div>
						<div style="margin-top: 10px; display: flex; gap: 10px;">
							${checklist.status !== 'completed' && hasPermission('checklist_fill') ? 
								`<button class="btn btn-primary" onclick="event.stopPropagation(); continueChecklist(${checklist.id})" style="padding: 5px 15px; font-size: 12px;">
									×”××©×š ×¦'×§ ×œ×™×¡×˜
								</button>` : ''
							}
							${hasPermission('checklist_create') ?
								`<button class="btn btn-secondary" onclick="event.stopPropagation(); editChecklist(${checklist.id})" style="padding: 5px 15px; font-size: 12px;">
									×¢×¨×•×š
								</button>
								<button class="btn btn-danger" onclick="event.stopPropagation(); deleteChecklistConfirm(${checklist.id})" style="padding: 5px 15px; font-size: 12px; background: #ff4757;">
									××—×§
								</button>` : ''
							}
						</div>
					</div>
				</div>
			`;
			
			container.innerHTML += html;
		});
	}

	// ×˜×¢×™× ×ª ××©×™××•×ª ×“×—×•×¤×•×ª
	function loadUrgentTasks() {
		const tasks = UrgentTasks.getTasks().filter(t => t.status === 'open');
		const container = document.querySelector('.task-list');
		
		if (tasks.length === 0) {
			container.innerHTML = `
				<div style="text-align: center; padding: 20px; color: #666;">
					××™×Ÿ ××©×™××•×ª ×“×—×•×¤×•×ª ğŸ‰
				</div>
			`;
			return;
		}
		
		container.innerHTML = '';
		
		tasks.forEach(task => {
			const typeClass = task.type === 'urgent' ? 'urgent' : 
							 task.type === 'overdue' ? 'overdue' : '';
			
			const priorityClass = task.priority === 'high' ? 'priority-high' : 'priority-medium';
			const priorityText = task.priority === 'high' ? '×“×—×•×£' : '×¨×’×™×œ';
			
			const timeText = task.dueIn ? `× ×•×ª×¨ ${task.dueIn} ×“×§×•×ª` : 
							task.type === 'overdue' ? `××™×—×•×¨ ×©×œ ${getMinutesAgo(task.createdAt)} ×“×§×•×ª` :
							`× ×¤×ª×— ${getTimeAgo(task.createdAt)}`;
			
			const html = `
				<div class="task-item ${typeClass}">
					<div class="task-header">
						<div class="task-title">${task.title}</div>
						<div class="task-priority ${priorityClass}">${priorityText}</div>
					</div>
					<div class="task-details">${task.description}</div>
					<div class="task-footer">
						<div class="task-time">${timeText}</div>
						${hasPermission('checklist_fill') ?
							`<button class="task-action" onclick="handleTask(${task.id})">×˜×¤×œ ×¢×›×©×™×•</button>` :
							''
						}
					</div>
				</div>
			`;
			
			container.innerHTML += html;
		});
	}

	// ×”×¦×’×ª ×”×™×¡×˜×•×¨×™×” ××¤×•×¨×˜×ª
	function showHistory() {
		if (!hasPermission('checklist_view')) {
			showMessage('××™×Ÿ ×œ×š ×”×¨×©××” ×œ×¦×¤×•×ª ×‘×”×™×¡×˜×•×¨×™×”', 'error');
			return;
		}
		
		// ×”×•×¡×£ ×›×¤×ª×•×¨×™ ×¡×™× ×•×Ÿ
		const filterButtons = `
			<div style="margin-bottom: 20px; display: flex; gap: 10px; justify-content: center;">
				<button class="btn ${currentFilter === 'all' ? 'btn-primary' : 'btn-secondary'}" 
						onclick="setFilter('all')" style="padding: 8px 16px;">
					×”×›×œ
				</button>
				<button class="btn ${currentFilter === 'active' ? 'btn-primary' : 'btn-secondary'}" 
						onclick="setFilter('active')" style="padding: 8px 16px;">
					×¤×¢×™×œ×™×
				</button>
				<button class="btn ${currentFilter === 'completed' ? 'btn-primary' : 'btn-secondary'}" 
						onclick="setFilter('completed')" style="padding: 8px 16px;">
					×”×•×©×œ××•
				</button>
			</div>
		`;
		
		// ×”×•×¡×£ ××ª ×›×¤×ª×•×¨×™ ×”×¡×™× ×•×Ÿ ×œ××–×•×¨ ×”×¨××©×™
		const container = document.querySelector('.container');
		const existingFilter = container.querySelector('.filter-buttons');
		if (!existingFilter) {
			const filterDiv = document.createElement('div');
			filterDiv.className = 'filter-buttons';
			filterDiv.innerHTML = filterButtons;
			container.insertBefore(filterDiv, container.querySelector('.checklist-types'));
		}
	}

	// ×”×’×“×¨×ª ×¤×™×œ×˜×¨
	function setFilter(filter) {
		currentFilter = filter;
		loadDashboard();
		
		// ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨×™ ×”×¡×™× ×•×Ÿ
		const buttons = document.querySelectorAll('.filter-buttons button');
		buttons.forEach(btn => {
			if (btn.textContent.includes('×”×›×œ') && filter === 'all' ||
				btn.textContent.includes('×¤×¢×™×œ×™×') && filter === 'active' ||
				btn.textContent.includes('×”×•×©×œ××•') && filter === 'completed') {
				btn.className = 'btn btn-primary';
			} else {
				btn.className = 'btn btn-secondary';
			}
		});
	}

	// ×™×™×¦×•× ×“×•×— ××¤×•×¨×˜
	function exportReport() {
		if (!hasPermission('reports_export')) {
			showMessage('××™×Ÿ ×œ×š ×”×¨×©××” ×œ×™×™×¦× ×“×•×—×•×ª', 'error');
			return;
		}
		
		const stats = ChecklistsDB.getStats();
		const checklists = ChecklistsDB.getChecklists();
		
		let report = '×“×•×— ×¦\'×§ ×œ×™×¡×˜×™× - ×¡×™× ××” ×¡×™×˜×™\n';
		report += '=' .repeat(50) + '\n\n';
		report += `×ª××¨×™×š: ${new Date().toLocaleDateString('he-IL')}\n`;
		report += `×©×¢×”: ${new Date().toLocaleTimeString('he-IL')}\n`;
		report += `××¤×™×§ ×”×“×•×—: ${localStorage.getItem('username') || '××©×ª××©'}\n\n`;
		
		report += '×¡×˜×˜×™×¡×˜×™×§×•×ª:\n';
		report += '-'.repeat(30) + '\n';
		report += `â€¢ ×”×•×©×œ××• ×”×™×•×: ${stats.completed}\n`;
		report += `â€¢ ×××ª×™× ×•×ª: ${stats.pending}\n`;
		report += `â€¢ ×‘××™×—×•×¨: ${stats.overdue}\n`;
		report += `â€¢ ×”×©×œ××” ×©×‘×•×¢×™×ª: ${stats.weeklyCompletion}%\n\n`;
		
		report += '×¨×©×™××ª ×¦\'×§ ×œ×™×¡×˜×™×:\n';
		report += '-'.repeat(30) + '\n';
		
		// ××™×•×Ÿ ×œ×¤×™ ×¡×˜×˜×•×¡
		const sorted = checklists.sort((a, b) => {
			const statusOrder = { 'overdue': 0, 'in_progress': 1, 'pending': 2, 'completed': 3 };
			return statusOrder[a.status] - statusOrder[b.status];
		});
		
		sorted.forEach(c => {
			const progress = c.totalTasks > 0 ? 
				Math.round((c.completedTasks / c.totalTasks) * 100) : 0;
			
			report += `\n[${c.id}] ${c.title}\n`;
			report += `  ×¡×˜×˜×•×¡: ${c.status}\n`;
			report += `  ×”×ª×§×“××•×ª: ${c.completedTasks}/${c.totalTasks} (${progress}%)\n`;
			report += `  ××—×¨××™: ${c.assignedTo}\n`;
			report += `  ×¢×“×›×•×Ÿ ××—×¨×•×Ÿ: ${new Date(c.lastUpdate).toLocaleString('he-IL')}\n`;
		});
		
		// ×”×•×¨×“×ª ×”×§×•×‘×¥
		const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
		const url = URL.createObjectURL(blob);
		const a = document.createElement('a');
		a.href = url;
		a.download = `checklist_report_${new Date().getTime()}.txt`;
		a.click();
		URL.revokeObjectURL(url);
		
		showMessage('×”×“×•×— ×”×•×¨×“ ×‘×”×¦×œ×—×”!', 'success');
	}

	// ×˜×™×¤×•×œ ×‘××©×™××” ×“×—×•×¤×”
	function handleTask(taskId) {
		if (!hasPermission('checklist_fill')) {
			showMessage('××™×Ÿ ×œ×š ×”×¨×©××” ×œ×˜×¤×œ ×‘××©×™××•×ª', 'error');
			return;
		}
		
		if (confirm('×”×× ×”××©×™××” ×˜×•×¤×œ×”?')) {
			UrgentTasks.completeTask(taskId);
			loadUrgentTasks();
			showMessage('×”××©×™××” ×¡×•×× ×” ×›×”×•×©×œ××”', 'success');
		}
	}

	// ×—×–×¨×” ×œ×“××©×‘×•×¨×“
	function goBack() {
		window.location.href = '../../index.html';
	}

	// ×”×¡×ª×¨×ª ××œ×× ×˜×™× ×œ×¤×™ ×”×¨×©××•×ª
	function updateUIPermissions() {
		if (!hasPermission('checklist_create')) {
			const createBtn = document.querySelector('.btn-primary[onclick*="createNewChecklist"]');
			if (createBtn) createBtn.style.display = 'none';
		}
		
		if (!hasPermission('reports_export')) {
			const exportBtn = document.querySelector('.btn-secondary[onclick*="exportReport"]');
			if (exportBtn) exportBtn.style.display = 'none';
		}
	}

	// ×¢×“×›×•×Ÿ × ×ª×•× ×™× ×‘×–××Ÿ ×××ª
	function updateStats() {
		loadDashboard();
	}

	// ×˜×¢×™× ×” ×¨××©×•× ×™×ª
	window.addEventListener('load', function() {
		if (!localStorage.getItem('rememberMe') && !sessionStorage.getItem('isLoggedIn')) {
			window.location.href = '../../login.html';
		}
		
		loadDashboard();
		updateUIPermissions();
		showHistory();
	});

	// ×¢×“×›×•×Ÿ ×›×œ 30 ×©× ×™×•×ª
	setInterval(updateStats, 30000);

	// ×× ×™××¦×™×” ×œ×›×¨×˜×™×¡×™×
	document.addEventListener('DOMContentLoaded', function() {
		const cards = document.querySelectorAll('.checklist-type, .task-item');
		cards.forEach((card, index) => {
			card.style.opacity = '0';
			card.style.transform = 'translateY(20px)';
			setTimeout(() => {
				card.style.transition = 'all 0.6s ease';
				card.style.opacity = '1';
				card.style.transform = 'translateY(0)';
			}, index * 150);
		});
	});
	</script>

	<!-- ×˜×¢×™× ×ª ××¢×¨×›×ª ×”×”×¨×©××•×ª -->
	<script src="../../assets/js/permissions.js"></script>
</body>
</html>