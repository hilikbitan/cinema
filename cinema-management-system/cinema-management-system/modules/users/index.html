<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ניהול משתמשים והרשאות - סינמה סיטי</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a73e8;
            --primary-dark: #1557b0;
            --secondary: #34a853;
            --danger: #ea4335;
            --warning: #fbbc04;
            --dark: #202124;
            --gray: #5f6368;
            --light-gray: #f8f9fa;
            --border: #dadce0;
            --shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            --shadow-hover: 0 10px 20px rgba(0,0,0,0.12), 0 4px 8px rgba(0,0,0,0.14);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
	
        .header h1 {
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header .icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: white;
            color: var(--primary);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-success {
            background: var(--secondary);
            color: white;
        }

        /* Navigation Tabs */
        .tabs {
            display: flex;
            background: var(--light-gray);
            border-bottom: 2px solid var(--border);
            overflow-x: auto;
        }

        .tab {
            padding: 15px 25px;
            background: none;
            border: none;
            font-size: 15px;
            font-weight: 500;
            color: var(--gray);
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab:hover {
            background: rgba(0,0,0,0.05);
        }

        .tab.active {
            color: var(--primary);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary);
        }

        /* Content Area */
        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            color: var(--gray);
            margin-top: 5px;
        }

        /* Search and Filter Bar */
        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
        }

        .search-box::before {
            content: '🔍';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
        }

        select {
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        /* Users Table */
        .table-container {
            background: white;
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: var(--light-gray);
            padding: 15px;
            text-align: right;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid var(--border);
        }

        td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        tr:hover {
            background: rgba(26, 115, 232, 0.05);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-left: 10px;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: #d4f4dd;
            color: #137333;
        }

        .status-inactive {
            background: #fce8e6;
            color: #c5221f;
        }

        .role-badge {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            background: var(--light-gray);
            color: var(--dark);
            margin: 2px;
            display: inline-block;
        }

        .role-admin { background: #fce4ec; color: #880e4f; }
        .role-supervisor { background: #e8f0fe; color: #1967d2; }
        .role-worker { background: #e6f4ea; color: #137333; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }

        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        /* Permissions Grid */
        .permissions-container {
            margin-top: 30px;
        }

        .permissions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .permission-category {
            background: var(--light-gray);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .permission-category h4 {
            margin-bottom: 15px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .permissions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .permission-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .permission-item:hover {
            box-shadow: var(--shadow);
        }

        .permission-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .permission-item label {
            cursor: pointer;
            flex: 1;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--secondary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Actions Menu */
        .actions-menu {
            position: relative;
        }

        .actions-btn {
            background: none;
            border: 1px solid var(--border);
            padding: 5px 10px;
            border-radius: 6px;
            cursor: pointer;
        }

        .actions-dropdown {
            display: none;
            position: fixed;
            left: 0;
            top: 100%;
            margin-top: 5px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: var(--shadow);
            min-width: 150px;
            z-index: 100;
        }

        .actions-dropdown.active {
            display: block;
        }

        .actions-dropdown button {
            width: 100%;
            padding: 10px 15px;
            background: none;
            border: none;
            text-align: right;
            cursor: pointer;
            font-size: 14px;
        }

        .actions-dropdown button:hover {
            background: var(--light-gray);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 20px;
            }

            .content {
                padding: 20px;
            }

            .filter-bar {
                flex-direction: column;
            }

            .search-box {
                width: 100%;
            }

            .table-container {
                overflow-x: auto;
            }

            table {
                min-width: 700px;
            }

            .modal-content {
                max-width: 100%;
                margin: 10px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .permissions-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid var(--light-gray);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Success Message */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .alert.active {
            display: flex;
        }

        .alert-success {
            background: #d4f4dd;
            color: #137333;
            border: 1px solid #137333;
        }

        .alert-error {
            background: #fce8e6;
            color: #c5221f;
            border: 1px solid #c5221f;
        }
		
		/* תיקון תפריט הפעולות */
		.actions-menu {
			position: relative;
		}

		.actions-dropdown {
			display: none;
			position: fixed;
			left: 0;
			top: 100%;
			margin-top: 5px;
			background: white;
			border: 1px solid var(--border);
			border-radius: 8px;
			box-shadow: 0 5px 20px rgba(0,0,0,0.2);
			min-width: 150px;
			z-index: 1000; /* הגדל את זה! */
		}

		/* אם התפריט קרוב לתחתית המסך, פתח אותו למעלה */
		.actions-dropdown.dropup {
			bottom: 100%;
			top: auto;
			margin-bottom: 5px;
			margin-top: 0;
		}

		/* וודא שהטבלה לא חוסמת */
		.table-container {
			position: relative;
			overflow: visible; /* שנה מ-hidden ל-visible */
		}

		/* אבל שמור על גלילה אופקית */
		.table-container table {
			overflow-x: auto;
		}
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                <div class="icon">👥</div>
                ניהול משתמשים והרשאות
            </h1>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="exportUsers()">
                    📥 ייצוא לאקסל
                </button>
                <button class="btn btn-primary" onclick="openAddUserModal()">
                    ➕ הוסף משתמש חדש
                </button>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('users')">
                👥 משתמשים פעילים
            </button>
            <button class="tab" onclick="switchTab('roles')">
                🎭 תפקידים והרשאות
            </button>
            <button class="tab" onclick="switchTab('logs')">
                📋 לוג פעילות
            </button>
            <button class="tab" onclick="switchTab('settings')">
                ⚙️ הגדרות מערכת
            </button>
        </div>

        <!-- Content Area -->
        <div class="content">
            <!-- Alert Messages -->
            <div id="alertMessage" class="alert alert-success">
                <span>✅</span>
                <span id="alertText">הפעולה בוצעה בהצלחה!</span>
            </div>

            <!-- Users Tab -->
            <div id="users-tab" class="tab-content active">
                <!-- Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">42</div>
                        <div class="stat-label">סה"כ משתמשים</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">38</div>
                        <div class="stat-label">משתמשים פעילים</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">5</div>
                        <div class="stat-label">מנהלים</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">12</div>
                        <div class="stat-label">סופרוויזרים</div>
                    </div>
                </div>

                <!-- Filter Bar -->
                <div class="filter-bar">
                    <div class="search-box">
                        <input type="text" placeholder="חיפוש משתמש..." id="searchUser">
                    </div>
                    <select id="roleFilter">
                        <option value="">כל התפקידים</option>
                        <option value="admin">מנהל מערכת</option>
                        <option value="supervisor">סופרוויזר</option>
                        <option value="worker">עובד מזנון</option>
                        <option value="usher">סדרן</option>
                        <option value="maintenance">אחזקה</option>
                    </select>
                    <select id="statusFilter">
                        <option value="">כל הסטטוסים</option>
                        <option value="active">פעיל</option>
                        <option value="inactive">לא פעיל</option>
                    </select>
                </div>

                <!-- Users Table -->
                <div class="table-container">
                    <table id="usersTable">
                        <thead>
                            <tr>
                                <th>משתמש</th>
                                <th>תפקיד</th>
                                <th>מחלקה</th>
                                <th>טלפון</th>
                                <th>סטטוס</th>
                                <th>כניסה אחרונה</th>
                                <th>פעולות</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Roles Tab -->
            <div id="roles-tab" class="tab-content">
                <h3>ניהול תפקידים והרשאות</h3>
                <div class="filter-bar">
                    <button class="btn btn-primary" onclick="openAddRoleModal()">
                        ➕ הוסף תפקיד חדש
                    </button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>תפקיד</th>
                                <th>תיאור</th>
                                <th>מספר משתמשים</th>
                                <th>הרשאות עיקריות</th>
                                <th>פעולות</th>
                            </tr>
                        </thead>
                        <tbody id="rolesTableBody">
                            <!-- Roles will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Logs Tab -->
            <div id="logs-tab" class="tab-content">
                <h3>לוג פעילות משתמשים</h3>
                <div class="filter-bar">
                    <div class="search-box">
                        <input type="text" placeholder="חיפוש בלוג...">
                    </div>
                    <input type="date" id="logDateFilter">
                    <select id="actionFilter">
                        <option value="">כל הפעולות</option>
                        <option value="login">כניסה</option>
                        <option value="logout">יציאה</option>
                        <option value="create">יצירה</option>
                        <option value="update">עדכון</option>
                        <option value="delete">מחיקה</option>
                    </select>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>זמן</th>
                                <th>משתמש</th>
                                <th>פעולה</th>
                                <th>פרטים</th>
                                <th>IP</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody">
                            <!-- Logs will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-content">
                <h3>הגדרות מערכת</h3>
                <div class="permission-category">
                    <h4>⚙️ הגדרות כלליות</h4>
                    <div class="form-group">
                        <label>זמן פסק זמן אוטומטי (דקות)</label>
                        <input type="number" value="30" min="5" max="120">
                    </div>
                    <div class="form-group">
                        <label>מספר ניסיונות כניסה מקסימלי</label>
                        <input type="number" value="3" min="1" max="10">
                    </div>
                    <div class="form-group">
                        <label>אפשר כניסה מרובה</label>
                        <div class="toggle-switch">
                            <input type="checkbox" id="multiLogin">
                            <span class="toggle-slider"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit User Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">הוסף משתמש חדש</h2>
                <button class="close-btn" onclick="closeModal('userModal')">✕</button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>שם פרטי *</label>
                            <input type="text" id="firstName" required>
                        </div>
                        <div class="form-group">
                            <label>שם משפחה *</label>
                            <input type="text" id="lastName" required>
                        </div>
                        <div class="form-group">
                            <label>אימייל</label>
                            <input type="email" id="email">
                        </div>
						<div class="form-group">
							<label>שם משתמש *</label>
							<input type="text" id="username" required placeholder="שם משתמש להתחברות">
						</div>
						<div class="form-group">
							<label>סיסמה *</label>
							<input type="password" id="userPassword" required placeholder="סיסמה להתחברות">
							<small style="color: #666; display: block; margin-top: 5px;">
								מינימום 6 תווים
							</small>
						</div>
                        <div class="form-group">
                            <label>טלפון</label>
                            <input type="tel" id="phone">
                        </div>
                        <div class="form-group">
                            <label>תפקיד *</label>
                            <select id="role" onchange="updatePermissions()">
                                <option value="">בחר תפקיד</option>
                                <option value="admin">מנהל מערכת</option>
                                <option value="supervisor">סופרוויזר</option>
                                <option value="worker">עובד מזנון</option>
                                <option value="usher">סדרן</option>
                                <option value="maintenance">אחזקה</option>
                                <option value="custom">מותאם אישית</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>מחלקה</label>
                            <select id="department">
                                <option value="management">הנהלה</option>
                                <option value="concession">מזנון</option>
                                <option value="projection">הקרנה</option>
                                <option value="cleaning">ניקיון</option>
                                <option value="maintenance">אחזקה</option>
                            </select>
                        </div>
                    </div>

                    <!-- Permissions Section -->
                    <div class="permissions-container">
                        <div class="permissions-header">
                            <h3>הרשאות</h3>
                            <button type="button" class="btn btn-secondary" onclick="selectAllPermissions()">
                                בחר הכל
                            </button>
                        </div>

                        <!-- Dashboard Permissions -->
                        <div class="permission-category">
                            <h4>📊 דאשבורד</h4>
                            <div class="permissions-grid">
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_dashboard_view">
                                    <label for="perm_dashboard_view">צפייה בדאשבורד</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_dashboard_stats">
                                    <label for="perm_dashboard_stats">צפייה בסטטיסטיקות</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_dashboard_reports">
                                    <label for="perm_dashboard_reports">הורדת דוחות</label>
                                </div>
                            </div>
                        </div>

                        <!-- Inventory Permissions -->
                        <div class="permission-category">
                            <h4>📦 מלאי מזנון</h4>
                            <div class="permissions-grid">
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_inventory_view">
                                    <label for="perm_inventory_view">צפייה במלאי</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_inventory_add">
                                    <label for="perm_inventory_add">הוספת מוצרים</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_inventory_edit">
                                    <label for="perm_inventory_edit">עריכת מלאי</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_inventory_delete">
                                    <label for="perm_inventory_delete">מחיקת מוצרים</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_inventory_reports">
                                    <label for="perm_inventory_reports">דוחות מלאי</label>
                                </div>
                            </div>
                        </div>

                        <!-- Checklists Permissions -->
                        <div class="permission-category">
                            <h4>✅ צ'ק ליסטים</h4>
                            <div class="permissions-grid">
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_checklist_view">
                                    <label for="perm_checklist_view">צפייה בצ'ק ליסטים</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_checklist_fill">
                                    <label for="perm_checklist_fill">מילוי צ'ק ליסטים</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_checklist_create">
                                    <label for="perm_checklist_create">יצירת תבניות</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_checklist_approve">
                                    <label for="perm_checklist_approve">אישור צ'ק ליסטים</label>
                                </div>
                            </div>
                        </div>

                        <!-- Reports Permissions -->
                        <div class="permission-category">
                            <h4>📋 דוחות</h4>
                            <div class="permissions-grid">
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_reports_view">
                                    <label for="perm_reports_view">צפייה בדוחות</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_reports_create">
                                    <label for="perm_reports_create">יצירת דוחות</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_reports_edit">
                                    <label for="perm_reports_edit">עריכת דוחות</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_reports_export">
                                    <label for="perm_reports_export">ייצוא דוחות</label>
                                </div>
                            </div>
                        </div>

                        <!-- Staff Management Permissions -->
                        <div class="permission-category">
                            <h4>👥 ניהול צוות</h4>
                            <div class="permissions-grid">
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_staff_view">
                                    <label for="perm_staff_view">צפייה בצוות</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_staff_schedule">
                                    <label for="perm_staff_schedule">ניהול משמרות</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_staff_training">
                                    <label for="perm_staff_training">ניהול הכשרות</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_staff_evaluate">
                                    <label for="perm_staff_evaluate">הערכת עובדים</label>
                                </div>
                            </div>
                        </div>

                        <!-- Maintenance Permissions -->
                        <div class="permission-category">
                            <h4>🔧 תחזוקה</h4>
                            <div class="permissions-grid">
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_maintenance_view">
                                    <label for="perm_maintenance_view">צפייה בתקלות</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_maintenance_report">
                                    <label for="perm_maintenance_report">דיווח תקלות</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_maintenance_manage">
                                    <label for="perm_maintenance_manage">ניהול תקלות</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_maintenance_close">
                                    <label for="perm_maintenance_close">סגירת תקלות</label>
                                </div>
                            </div>
                        </div>

                        <!-- System Permissions -->
                        <div class="permission-category">
                            <h4>⚙️ מערכת</h4>
                            <div class="permissions-grid">
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_users_view">
                                    <label for="perm_users_view">צפייה במשתמשים</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_users_manage">
                                    <label for="perm_users_manage">ניהול משתמשים</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_settings_view">
                                    <label for="perm_settings_view">צפייה בהגדרות</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_settings_manage">
                                    <label for="perm_settings_manage">ניהול הגדרות</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" id="perm_logs_view">
                                    <label for="perm_logs_view">צפייה בלוגים</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('userModal')">ביטול</button>
                <button class="btn btn-success" onclick="saveUser()">שמור משתמש</button>
            </div>
        </div>
    </div>

    <script>
	
        // ניהול נתוני משתמשים ב-localStorage
		const UsersDB = {
			// טעינת משתמשים מה-localStorage
			getUsers: function() {
				const savedUsers = localStorage.getItem('cinema_users');
				if (savedUsers) {
					return JSON.parse(savedUsers);
				}
				
				// אם אין משתמשים, צור רשימת ברירת מחדל
				const defaultUsers = [
					{
						id: 1,
						username: 'admin',
						password: 'admin123',
						firstName: 'מנהל',
						lastName: 'ראשי',
						email: 'admin@cinema.com',
						phone: '050-1234567',
						role: 'admin',
						department: 'management',
						status: 'active',
						lastLogin: new Date().toISOString(),
						permissions: this.getPermissionsForRole('admin')
					},
					{
						id: 2,
						username: 'manager',
						password: 'manager123',
						firstName: 'מנהל',
						lastName: 'מתחם',
						email: 'manager@cinema.com',
						phone: '052-2345678',
						role: 'manager',
						department: 'management',
						status: 'active',
						lastLogin: new Date().toISOString(),
						permissions: this.getPermissionsForRole('manager')
					},
					{
						id: 3,
						username: 'supervisor',
						password: 'super123',
						firstName: 'שירה',
						lastName: 'לוי',
						email: 'shira@cinema.com',
						phone: '052-3456789',
						role: 'supervisor',
						department: 'concession',
						status: 'active',
						lastLogin: new Date().toISOString(),
						permissions: this.getPermissionsForRole('supervisor')
					}
				];
				
				// שמור את רשימת ברירת המחדל
				this.saveUsers(defaultUsers);
				return defaultUsers;
			},
			
			// שמירת משתמשים ל-localStorage
			saveUsers: function(users) {
				localStorage.setItem('cinema_users', JSON.stringify(users));
			},
			
			// הוספת משתמש חדש
			addUser: function(userData) {
				const users = this.getUsers();
				
				// בדיקה אם שם המשתמש כבר קיים
				if (users.find(u => u.username === userData.username)) {
					return { success: false, message: 'שם המשתמש כבר קיים במערכת' };
				}
				
				// יצירת ID חדש
				const newId = Math.max(...users.map(u => u.id)) + 1;
				
				// הוספת המשתמש החדש
				const newUser = {
					...userData,
					id: newId,
					status: 'active',
					lastLogin: null,
					permissions: userData.permissions || this.getPermissionsForRole(userData.role)
				};
				
				users.push(newUser);
				this.saveUsers(users);
				
				return { success: true, user: newUser };
			},
			
			// עדכון משתמש קיים
			updateUser: function(userId, userData) {
				const users = this.getUsers();
				const userIndex = users.findIndex(u => u.id === userId);
				
				if (userIndex === -1) {
					return { success: false, message: 'המשתמש לא נמצא' };
				}
				
				// בדיקה אם שם המשתמש החדש כבר קיים (למשתמש אחר)
				if (userData.username && users.find(u => u.username === userData.username && u.id !== userId)) {
					return { success: false, message: 'שם המשתמש כבר קיים במערכת' };
				}
				
				// עדכון המשתמש
				users[userIndex] = {
					...users[userIndex],
					...userData,
					permissions: userData.permissions || this.getPermissionsForRole(userData.role)
				};
				
				this.saveUsers(users);
				return { success: true, user: users[userIndex] };
			},
			
			// מחיקת משתמש
			deleteUser: function(userId) {
				const users = this.getUsers();
				const filteredUsers = users.filter(u => u.id !== userId);
				this.saveUsers(filteredUsers);
				return { success: true };
			},
			
			// קבלת הרשאות לפי תפקיד
			getPermissionsForRole: function(role) {
				const rolePermissions = {
					admin: [
						'dashboard_view', 'dashboard_stats', 'dashboard_reports',
						'inventory_view', 'inventory_add', 'inventory_edit', 'inventory_delete',
						'checklist_view', 'checklist_fill', 'checklist_create', 'checklist_approve',
						'reports_view', 'reports_create', 'reports_edit', 'reports_export',
						'staff_view', 'staff_schedule', 'staff_training', 'staff_evaluate',
						'users_view', 'users_manage', 'settings_view', 'settings_manage',
						'monitoring_view', 'alerts_view', 'analytics_view'
					],
					manager: [
						'dashboard_view', 'dashboard_stats', 'dashboard_reports',
						'inventory_view', 'inventory_add', 'inventory_edit',
						'checklist_view', 'checklist_fill', 'checklist_create', 'checklist_approve',
						'reports_view', 'reports_create', 'reports_edit', 'reports_export',
						'staff_view', 'staff_schedule', 'staff_training',
						'users_view', 'settings_view',
						'monitoring_view', 'alerts_view', 'analytics_view'
					],
					supervisor: [
						'dashboard_view', 'dashboard_stats',
						'inventory_view', 'inventory_add', 'inventory_edit',
						'checklist_view', 'checklist_fill', 'checklist_approve',
						'reports_view', 'reports_create', 'reports_export',
						'staff_view', 'staff_schedule',
						'users_view',
						'monitoring_view', 'alerts_view'
					],
					worker: [
						'dashboard_view',
						'inventory_view',
						'checklist_view', 'checklist_fill',
						'reports_view',
						'alerts_view'
					],
					usher: [
						'dashboard_view',
						'checklist_view', 'checklist_fill',
						'reports_view', 'reports_create',
						'alerts_view'
					]
				};
				
				return rolePermissions[role] || [];
			}
		};

		// משתנים גלובליים
		let currentEditingUserId = null;

		// נתוני תפקידים
		const roles = [
			{
				name: 'admin',
				title: 'מנהל מערכת',
				description: 'גישה מלאה לכל המערכת',
				permissions: ['כל ההרשאות']
			},
			{
				name: 'manager',
				title: 'מנהל מתחם',
				description: 'ניהול כולל ללא הרשאות מערכת',
				permissions: ['דוחות', 'צוות', 'מלאי', 'תפעול']
			},
			{
				name: 'supervisor',
				title: 'סופרוויזר',
				description: 'ניהול צוות ודוחות',
				permissions: ['דוחות', 'צוות', 'מלאי']
			},
			{
				name: 'worker',
				title: 'עובד מזנון',
				description: 'ניהול מלאי ומכירות',
				permissions: ['מלאי', 'מכירות']
			},
			{
				name: 'usher',
				title: 'סדרן',
				description: 'ניהול אולמות ולקוחות',
				permissions: ['אולמות', 'דוחות יומיים']
			}
		];

		// לוגים - נשמר בזיכרון בלבד (יתאפס ברענון)
		const logs = [];

		// פונקציה להוספת לוג
		function addLog(action, details) {
			const currentUser = JSON.parse(localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser') || '{}');
			logs.unshift({
				time: new Date().toLocaleString('he-IL'),
				user: currentUser.username || 'מערכת',
				action: action,
				details: details,
				ip: '192.168.1.' + Math.floor(Math.random() * 255)
			});
		}

		// טעינת נתונים בהתחלה
		loadUsers();
		loadRoles();
		loadLogs();

		// טעינת משתמשים
		function loadUsers() {
			const users = UsersDB.getUsers();
			const tbody = document.getElementById('usersTableBody');
			tbody.innerHTML = '';
			
			// עדכון סטטיסטיקות
			document.querySelector('.stat-value').textContent = users.length;
			document.querySelectorAll('.stat-value')[1].textContent = users.filter(u => u.status === 'active').length;
			document.querySelectorAll('.stat-value')[2].textContent = users.filter(u => u.role === 'admin').length;
			document.querySelectorAll('.stat-value')[3].textContent = users.filter(u => u.role === 'supervisor').length;
			
			users.forEach(user => {
				const row = document.createElement('tr');
				row.innerHTML = `
					<td>
						<div class="user-info">
							<div class="user-avatar">${user.firstName[0]}${user.lastName[0]}</div>
							<div>
								<div>${user.firstName} ${user.lastName}</div>
								<div style="font-size: 12px; color: var(--gray);">
									${user.username} | ${user.email}
								</div>
							</div>
						</div>
					</td>
					<td>
						<span class="role-badge role-${user.role}">
							${getRoleTitle(user.role)}
						</span>
					</td>
					<td>${getDepartmentTitle(user.department)}</td>
					<td>${user.phone}</td>
					<td>
						<span class="status-badge status-${user.status}">
							${user.status === 'active' ? 'פעיל' : 'לא פעיל'}
						</span>
					</td>
					<td>${user.lastLogin ? new Date(user.lastLogin).toLocaleString('he-IL') : 'טרם התחבר'}</td>
					 <td>
						<div style="display: flex; gap: 5px; flex-wrap: wrap;">
							<button onclick="editUser(${user.id})" class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px;">
								✏️
							</button>
							<button onclick="resetPassword(${user.id})" class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px;">
								🔑
							</button>
							<button onclick="deleteUser(${user.id})" class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;">
								🗑️
							</button>
						</div>
					</td>
				`;
				tbody.appendChild(row);
			});
		}

		// טעינת תפקידים
		function loadRoles() {
			const users = UsersDB.getUsers();
			const tbody = document.getElementById('rolesTableBody');
			tbody.innerHTML = '';
			
			roles.forEach(role => {
				const userCount = users.filter(u => u.role === role.name).length;
				const row = document.createElement('tr');
				row.innerHTML = `
					<td>
						<span class="role-badge role-${role.name}">${role.title}</span>
					</td>
					<td>${role.description}</td>
					<td>${userCount}</td>
					<td>${role.permissions.join(', ')}</td>
					<td>
						<button class="btn btn-secondary" onclick="editRole('${role.name}')">ערוך</button>
					</td>
				`;
				tbody.appendChild(row);
			});
		}

		// טעינת לוגים
		function loadLogs() {
			const tbody = document.getElementById('logsTableBody');
			tbody.innerHTML = '';
			
			logs.forEach(log => {
				const row = document.createElement('tr');
				row.innerHTML = `
					<td>${log.time}</td>
					<td>${log.user}</td>
					<td>${getActionTitle(log.action)}</td>
					<td>${log.details}</td>
					<td>${log.ip}</td>
				`;
				tbody.appendChild(row);
			});
		}

		// פתיחת מודאל הוספת משתמש
		function openAddUserModal() {
			currentEditingUserId = null;
			document.getElementById('modalTitle').textContent = 'הוסף משתמש חדש';
			document.getElementById('userForm').reset();
			document.getElementById('userModal').classList.add('active');
		}

		// עריכת משתמש
		function editUser(userId) {
			const users = UsersDB.getUsers();
			const user = users.find(u => u.id === userId);
			if (!user) return;
			
			currentEditingUserId = userId;
			document.getElementById('modalTitle').textContent = 'ערוך משתמש';
			document.getElementById('firstName').value = user.firstName;
			document.getElementById('lastName').value = user.lastName;
			document.getElementById('username').value = user.username;
			document.getElementById('userPassword').value = user.password;
			document.getElementById('email').value = user.email;
			document.getElementById('phone').value = user.phone;
			document.getElementById('role').value = user.role;
			document.getElementById('department').value = user.department;
			
			updatePermissions();
			document.getElementById('userModal').classList.add('active');
		}

		// שמירת משתמש
		function saveUser() {
			// איסוף נתונים מהטופס
			const userData = {
				firstName: document.getElementById('firstName').value.trim(),
				lastName: document.getElementById('lastName').value.trim(),
				username: document.getElementById('username').value.trim(),
				password: document.getElementById('userPassword').value,
				email: document.getElementById('email').value.trim(),
				phone: document.getElementById('phone').value.trim(),
				role: document.getElementById('role').value,
				department: document.getElementById('department').value,
				permissions: []
			};
			
			// איסוף הרשאות
			document.querySelectorAll('.permission-item input:checked').forEach(input => {
				userData.permissions.push(input.id.replace('perm_', ''));
			});
			
			// אימות
			if (!userData.firstName || !userData.lastName || !userData.username || 
				!userData.password || !userData.email || !userData.role) {
				showAlert('נא למלא את כל השדות החובה', 'error');
				return;
			}
			
			if (userData.password.length < 6) {
				showAlert('הסיסמה חייבת להכיל לפחות 6 תווים', 'error');
				return;
			}
			
			// שמירה או עדכון
			let result;
			if (currentEditingUserId) {
				result = UsersDB.updateUser(currentEditingUserId, userData);
				if (result.success) {
					addLog('update', `עדכון משתמש: ${userData.firstName} ${userData.lastName}`);
				}
			} else {
				result = UsersDB.addUser(userData);
				if (result.success) {
					addLog('create', `יצירת משתמש חדש: ${userData.firstName} ${userData.lastName}`);
				}
			}
			
			if (result.success) {
				showAlert(currentEditingUserId ? 'המשתמש עודכן בהצלחה!' : 'המשתמש נוסף בהצלחה!', 'success');
				closeModal('userModal');
				loadUsers();
				loadLogs();
			} else {
				showAlert(result.message, 'error');
			}
		}

		// מחיקת משתמש
		function deleteUser(userId) {
			const users = UsersDB.getUsers();
			const user = users.find(u => u.id === userId);
			
			if (confirm(`האם אתה בטוח שברצונך למחוק את המשתמש ${user.firstName} ${user.lastName}?`)) {
				const result = UsersDB.deleteUser(userId);
				if (result.success) {
					addLog('delete', `מחיקת משתמש: ${user.firstName} ${user.lastName}`);
					showAlert('המשתמש נמחק בהצלחה', 'success');
					loadUsers();
					loadLogs();
				}
			}
		}

		// איפוס סיסמה
		function resetPassword(userId) {
			const users = UsersDB.getUsers();
			const user = users.find(u => u.id === userId);
			
			if (confirm(`האם לאפס את הסיסמה של ${user.firstName} ${user.lastName}?`)) {
				const newPassword = prompt('הזן סיסמה חדשה (מינימום 6 תווים):');
				
				if (newPassword && newPassword.length >= 6) {
					const result = UsersDB.updateUser(userId, { password: newPassword });
					if (result.success) {
						addLog('update', `איפוס סיסמה למשתמש: ${user.firstName} ${user.lastName}`);
						showAlert('הסיסמה אופסה בהצלחה', 'success');
					}
				} else if (newPassword) {
					showAlert('הסיסמה חייבת להכיל לפחות 6 תווים', 'error');
				}
			}
		}

		// שינוי סטטוס משתמש
		function toggleUserStatus(userId) {
			const users = UsersDB.getUsers();
			const user = users.find(u => u.id === userId);
			
			if (user) {
				const newStatus = user.status === 'active' ? 'inactive' : 'active';
				const result = UsersDB.updateUser(userId, { status: newStatus });
				
				if (result.success) {
					addLog('update', `${newStatus === 'active' ? 'הפעלת' : 'השבתת'} משתמש: ${user.firstName} ${user.lastName}`);
					showAlert(`המשתמש ${newStatus === 'active' ? 'הופעל' : 'הושבת'} בהצלחה`, 'success');
					loadUsers();
					loadLogs();
				}
			}
		}

		// הצגת הרשאות משתמש
		function viewUserPermissions(userId) {
			const users = UsersDB.getUsers();
			const user = users.find(u => u.id === userId);
			
			if (user) {
				const permissionsList = user.permissions.join('\n• ');
				alert(`הרשאות של ${user.firstName} ${user.lastName}:\n\n• ${permissionsList}`);
			}
		}

		// פונקציות עזר
		function getRoleTitle(role) {
			const titles = {
				admin: 'מנהל מערכת',
				manager: 'מנהל מתחם',
				supervisor: 'סופרוויזר',
				worker: 'עובד מזנון',
				usher: 'סדרן',
				maintenance: 'אחזקה'
			};
			return titles[role] || role;
		}

		function getDepartmentTitle(dept) {
			const titles = {
				management: 'הנהלה',
				concession: 'מזנון',
				projection: 'הקרנה',
				cleaning: 'ניקיון',
				maintenance: 'אחזקה'
			};
			return titles[dept] || dept;
		}

		function getActionTitle(action) {
			const titles = {
				login: '🔑 כניסה',
				logout: '🚪 יציאה',
				create: '➕ יצירה',
				update: '✏️ עדכון',
				delete: '🗑️ מחיקה'
			};
			return titles[action] || action;
		}

		// עדכון הרשאות לפי תפקיד
		function updatePermissions() {
			const role = document.getElementById('role').value;
			if (!role || role === 'custom') return;
			
			// נקה את כל ההרשאות
			document.querySelectorAll('.permission-item input').forEach(input => {
				input.checked = false;
			});
			
			// הגדר הרשאות לפי התפקיד
			const permissions = UsersDB.getPermissionsForRole(role);
			permissions.forEach(perm => {
				const checkbox = document.getElementById('perm_' + perm);
				if (checkbox) checkbox.checked = true;
			});
		}

		// בחירת כל ההרשאות
		function selectAllPermissions() {
			const allChecked = Array.from(document.querySelectorAll('.permission-item input')).every(cb => cb.checked);
			document.querySelectorAll('.permission-item input').forEach(input => {
				input.checked = !allChecked;
			});
		}

		// סגירת מודאל
		function closeModal(modalId) {
			document.getElementById(modalId).classList.remove('active');
			currentEditingUserId = null;
		}

		// הצגת הודעה
		function showAlert(message, type = 'success') {
			const alert = document.getElementById('alertMessage');
			const alertText = document.getElementById('alertText');
			
			alert.className = `alert alert-${type} active`;
			alertText.textContent = message;
			
			setTimeout(() => {
				alert.classList.remove('active');
			}, 3000);
		}

		// החלפת טאב
		function switchTab(tabName) {
			document.querySelectorAll('.tab').forEach(tab => {
				tab.classList.remove('active');
			});
			event.target.classList.add('active');
			
			document.querySelectorAll('.tab-content').forEach(content => {
				content.classList.remove('active');
			});
			document.getElementById(`${tabName}-tab`).classList.add('active');
		}

		// תפריט פעולות
		function toggleActionsMenu(userId) {
			const button = event.currentTarget;
			const menu = document.getElementById(`actions-${userId}`);
			
			// סגור תפריטים אחרים
			document.querySelectorAll('.actions-dropdown').forEach(dropdown => {
				if (dropdown.id !== `actions-${userId}`) {
					dropdown.classList.remove('active');
				}
			});
			
			// מקם את התפריט ליד הכפתור
			if (!menu.classList.contains('active')) {
				const rect = button.getBoundingClientRect();
				menu.style.top = `${rect.bottom + 5}px`;
				menu.style.left = `${rect.left}px`;
				
				// בדוק אם יוצא מהמסך
				menu.classList.add('active');
				const menuRect = menu.getBoundingClientRect();
				
				// אם יוצא מימין
				if (menuRect.right > window.innerWidth) {
					menu.style.left = `${rect.right - menu.offsetWidth}px`;
				}
				
				// אם יוצא מלמטה
				if (menuRect.bottom > window.innerHeight) {
					menu.style.top = `${rect.top - menu.offsetHeight - 5}px`;
				}
			} else {
				menu.classList.remove('active');
			}
			
			// סגור בלחיצה החוצה
			event.stopPropagation();
			document.addEventListener('click', function closeMenu(e) {
				if (!e.target.closest('.actions-menu')) {
					menu.classList.remove('active');
					document.removeEventListener('click', closeMenu);
				}
			});
		}

		// חיפוש משתמשים
		document.getElementById('searchUser').addEventListener('input', function(e) {
			const searchTerm = e.target.value.toLowerCase();
			const rows = document.querySelectorAll('#usersTableBody tr');
			
			rows.forEach(row => {
				const text = row.textContent.toLowerCase();
				row.style.display = text.includes(searchTerm) ? '' : 'none';
			});
		});

		// סינון משתמשים
		document.getElementById('roleFilter').addEventListener('change', filterUsers);
		document.getElementById('statusFilter').addEventListener('change', filterUsers);

		function filterUsers() {
			const roleFilter = document.getElementById('roleFilter').value;
			const statusFilter = document.getElementById('statusFilter').value;
			const users = UsersDB.getUsers();
			
			const filteredUsers = users.filter(user => {
				const roleMatch = !roleFilter || user.role === roleFilter;
				const statusMatch = !statusFilter || user.status === statusFilter;
				return roleMatch && statusMatch;
			});
			
			// טען מחדש את הטבלה עם המשתמשים המסוננים
			const tbody = document.getElementById('usersTableBody');
			tbody.innerHTML = '';
			
			filteredUsers.forEach(user => {
				// קוד זהה לפונקציה loadUsers
				const row = document.createElement('tr');
				row.innerHTML = `...`; // אותו HTML כמו ב-loadUsers
				tbody.appendChild(row);
			});
		}

		// ייצוא לאקסל (סימולציה)
		function exportUsers() {
			const users = UsersDB.getUsers();
			console.log('Exporting users:', users);
			showAlert('הדוח מוכן להורדה', 'success');
		}

		// סגירה ב-ESC
		document.addEventListener('keydown', function(e) {
			if (e.key === 'Escape') {
				document.querySelectorAll('.modal.active').forEach(modal => {
					modal.classList.remove('active');
				});
			}
		});

		// סגירה בלחיצה על הרקע
		document.querySelectorAll('.modal').forEach(modal => {
			modal.addEventListener('click', function(e) {
				if (e.target === modal) {
					modal.classList.remove('active');
				}
			});
		});
    </script>
</body>
</html>